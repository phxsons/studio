"use client";

import { GoogleMap, DirectionsRenderer, Marker } from "@react-google-maps/api";
import { useMemo } from "react";

interface MapProps {
  directionsResponse: google.maps.DirectionsResult | null;
}

export default function Map({ directionsResponse }: MapProps) {
  const center = useMemo(() => ({
    lat: 39.8283,
    lng: -98.5795
  }), []);

  const startMarker = useMemo(() => {
    if (!directionsResponse) return null;
    const leg = directionsResponse.routes[0].legs[0];
    return {
      position: leg.start_location,
      icon: {
        url: '/logo.png',
        scaledSize: new window.google.maps.Size(50, 50),
      }
    };
  }, [directionsResponse]);

  const endMarker = useMemo(() => {
    if (!directionsResponse) return null;
    const leg = directionsResponse.routes[0].legs[directionsResponse.routes[0].legs.length - 1];
    return {
      position: leg.end_location,
      icon: {
        url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
          <svg width="40" height="40" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0 0H8V1H0V0ZM8 1H7V2H8V1ZM7 2H6V3H7V2ZM6 3H5V4H6V3ZM5 4H4V5H5V4ZM4 5H3V6H4V5ZM3 6H2V7H3V6ZM2 7H1V8H2V7ZM1 8H0V9H1V8ZM0 9H1V10H0V9ZM1 10H2V11H1V10ZM2 11H3V12H2V11ZM3 12H4V13H3V12ZM4 13H5V14H4V13ZM5 14H6V15H5V14ZM6 15H7V16H6V15ZM7 16H8V15H7V16ZM8 1V2H9V1H8ZM9 2H10V3H9V2ZM10 3H11V4H10V3ZM11 4H12V5H11V4ZM12 5H13V6H12V5ZM13 6H14V7H13V6ZM14 7H15V8H14V7ZM15 8H16V9H15V8ZM16 9H15V10H16V9ZM15 10H14V11H15V10ZM14 11H13V12H14V11ZM13 12H12V13H13V12ZM12 13H11V14H12V13ZM11 14H10V15H11V14ZM10 15H9V16H10V15ZM9 16H8V15H9V16ZM1 2H2V1H1V2ZM2 3H3V2H2V3ZM3 4H4V3H3V4ZM4 5H5V4H4V5ZM5 6H6V5H5V6ZM6 7H7V6H6V7ZM7 8H8V7H7V8ZM1 1H0V2H1V1ZM2 2H1V3H2V2ZM3 3H2V4H3V3ZM4 4H3V5H4V4ZM5 5H4V6H5V5ZM6 6H5V7H6V6ZM7 7H6V8H7V7ZM8 8H7V9H8V8ZM0 3H1V4H0V3ZM1 4H2V5H1V4ZM2 5H3V6H2V5ZM3 6H4V7H3V6ZM4 7H5V8H4V7ZM5 8H6V9H5V8ZM6 9H7V10H6V9ZM7 10H8V11H7V10ZM0 5H1V6H0V5ZM1 6H2V7H1V6ZM2 7H3V8H2V7ZM3 8H4V9H3V8ZM4 9H5V10H4V9ZM5 10H6V11H5V10ZM6 11H7V12H6V11ZM7 12H8V13H7V12ZM0 7H1V8H0V7ZM1 8H2V9H1V8ZM2 9H3V10H2V9ZM3 10H4V11H3V10ZM4 11H5V12H4V11ZM5 12H6V13H5V12ZM6 13H7V14H6V13ZM7 14H8V15H7V14ZM1 9H0V10H1V9ZM2 10H1V11H2V10ZM3 11H2V12H3V11ZM4 12H3V13H4V12ZM5 13H4V14H5V13ZM6 14H5V15H6V14ZM7 15H6V16H7V15ZM8 14H9V15H8V14ZM8 12H9V13H8V12ZM8 10H9V11H8V10ZM8 6H9V7H8V6ZM8 4H9V5H8V4ZM10 1H9V0H10V1ZM11 2H10V1H11V2ZM12 3H11V2H12V3ZM13 4H12V3H13V4ZM14 5H13V4H14V5ZM15 6H14V5H15V6ZM16 7H15V6H16V7ZM9 0H10V1H9V0ZM10 1H11V2H10V1ZM11 2H12V3H11V2ZM12 3H13V4H12V3ZM13 4H14V5H13V4ZM14 5H15V6H14V5ZM15 6H16V7H15V6ZM16 7H15V8H16V7ZM10 2H9V3H10V2ZM11 3H10V4H11V3ZM12 4H11V5H12V4ZM13 5H12V6H13V5ZM14 6H13V7H14V6ZM15 7H14V8H15V7ZM16 8H15V9H16V8ZM10 4H9V5H10V4ZM11 5H10V6H11V5ZM12 6H11V7H12V6ZM13 7H12V8H13V7ZM14 8H13V9H14V8ZM15 9H14V10H15V9ZM16 10H15V11H16V10ZM10 6H9V7H10V6ZM11 7H10V8H11V7ZM12 8H11V9H12V8ZM13 9H12V10H13V9ZM14 10H13V11H14V10ZM15 11H14V12H15V11ZM16 12H15V13H16V12ZM10 8H9V9H10V8ZM11 9H10V10H11V9ZM12 10H11V11H12V10ZM13 11H12V12H13V11ZM14 12H13V13H14V12ZM15 13H14V14H15V13ZM16 14H15V15H16V14ZM10 10H9V11H10V10ZM11 11H10V12H11V11ZM12 12H11V13H12V12ZM13 13H12V14H13V13ZM14 14H13V15H14V14ZM15 15H14V16H15V15ZM9 15H8V16H9V15ZM9 13H8V14H9V13ZM9 11H8V12H9V11ZM9 9H8V10H9V9ZM9 7H8V8H9V7ZM9 5H8V6H9V5ZM9 3H8V4H9V3ZM8 2H9V3H8V2ZM8 0H7V1H8V0ZM7 1H6V2H7V1ZM6 2H5V3H6V2ZM5 3H4V4H5V3ZM4 4H3V5H4V4ZM3 5H2V6H3V5ZM2 6H1V7H2V6ZM1 7H0V8H1V7ZM1 1H2V0H1V1ZM2 0H3V1H2V0ZM3 1H4V2H3V1ZM4 2H5V3H4V2ZM5 3H6V4H5V3ZM6 4H7V5H6V4ZM7 5H8V6H7V5ZM2 10H3V9H2V10ZM3 9H4V8H3V9ZM4 8H5V7H4V8ZM5 7H6V6H5V7ZM6 6H7V5H6V6ZM7 5H8V4H7V5ZM1 12H2V11H1V12ZM2 11H3V10H2V11ZM3 10H4V9H3V10ZM4 9H5V8H4V9ZM5 8H6V7H5V8ZM6 7H7V6H6V7ZM7 6H8V5H7V6ZM1 14H2V13H1V14ZM2 13H3V12H2V13ZM3 12H4V11H3V12ZM4 11H5V10H4V11ZM5 10H6V9H5V10ZM6 9H7V8H6V9ZM7 8H8V7H7V8ZM1 16H2V15H1V16ZM2 15H3V14H2V15ZM3 14H4V13H3V14ZM4 13H5V12H4V13ZM5 12H6V11H5V12ZM6 11H7V10H6V11ZM7 10H8V9H7V10ZM9 14H10V13H9V14ZM10 13H11V12H10V13ZM11 12H12V11H11V12ZM12 11H13V10H12V11ZM13 10H14V9H13V10ZM14 9H15V8H14V9ZM15 8H16V7H15V8ZM9 12H10V11H9V12ZM10 11H11V10H10V11ZM11 10H12V9H11V10ZM12 9H13V8H12V9ZM13 8H14V7H13V8ZM14 7H15V6H14V7ZM15 6H16V5H15V6ZM9 10H10V9H9V10ZM10 9H11V8H10V9ZM11 8H12V7H11V8ZM12 7H13V6H12V7ZM13 6H14V5H13V6ZM14 5H15V4H14V5ZM15 4H16V3H15V4ZM9 8H10V7H9V8ZM10 7H11V6H10V7ZM11 6H12V5H11V6ZM12 5H13V4H12V5ZM13 4H14V3H13V4ZM14 3H15V2H14V3ZM15 2H16V1H15V2ZM9 6H10V5H9V6ZM10 5H11V4H10V5ZM11 4H12V3H11V4ZM12 3H13V2H12V3ZM13 2H14V1H13V2ZM14 1H15V0H14V1ZM15 0H16V1H15V0Z" fill="black"/>
          </svg>
        `),
        scaledSize: new window.google.maps.Size(40, 40),
        anchor: new window.google.maps.Point(0, 40),
      }
    };
  }, [directionsResponse]);


  return (
    <GoogleMap
      mapContainerClassName="h-full w-full"
      center={center}
      zoom={4}
    >
      {directionsResponse && (
        <DirectionsRenderer 
          directions={directionsResponse} 
          options={{ suppressMarkers: true }}
        />
      )}
      {startMarker && <Marker position={startMarker.position} icon={startMarker.icon} />}
      {endMarker && <Marker position={endMarker.position} icon={endMarker.icon} />}
    </GoogleMap>
  );
}
